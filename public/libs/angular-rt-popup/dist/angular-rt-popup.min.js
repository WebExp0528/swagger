angular.module("rt.popup",[]).factory("Popup",["$window","$document","$timeout","$compile","$parse",function(a,b,c,d,e){function f(a){return a.isDefaultPrevented()?void(o=null):void(null!==o&&o!==!1||!n||$.contains(n.el[0],a.target)||(o=null,h()))}function g(a){n&&(o=$.contains(n.el[0],a.target))}function h(){if(n){var a=n;n=null,c(function(){e(a.options.popupHidden)(a.scope),a.el.hide().remove(),b.off("click",f),b.off("mousedown",g)})}}function i(a,b){for(var c in b)a[c]||(a[c]=b[c])}function j(a,b,d){i(d,{popupPlacement:"right",popupPlacementFn:null,popupClass:"",popupShown:"",popupHidden:"",popupOverlap:"5"}),b.popupView=d.popupShow,b.hidePopover=h,c(function(){m(a,b,d)})}function k(c){var d=c[0].getBoundingClientRect();return{width:d.width||c.prop("offsetWidth"),height:d.height||c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].documentElement.scrollLeft)}}function l(c,d,h,i,j){var l=null,m=null,n=null,o=k(d),p=j.popupPlacement,r=j.popupPlacementFn?e(j.popupPlacementFn)(c):null;angular.isFunction(r)&&(p=r(o));var s=a.innerHeight-2*q,t=+j.popupOverlap;if("right"===p)n={top:o.top+o.height/2,left:o.left+o.width-t},l={top:n.top-h.height()/2,left:n.left},l.top=Math.max(q,l.top),s-=l.top,m={top:n.top-l.top};else if("left"===p)n={top:o.top+o.height/2,left:o.left+t-2},l={top:n.top-h.height()/2,right:a.innerWidth-n.left},l.top=Math.max(q,l.top),s-=l.top,m={top:n.top-l.top};else if("bottom"===p)n={top:o.top+o.height,left:o.left+o.width/2},l={top:n.top-t,left:n.left-h.width()/2},l.left=Math.max(q,l.left),s-=l.top,m={left:n.left-l.left};else if("bottom-left"===p)n={top:o.top+o.height,left:o.left+h.width()/2},l={top:n.top-t,left:n.left-h.width()/2},l.left=Math.max(q,l.left),s-=l.top,p="bottom",m={left:n.left-l.left};else{if("top"!==p)throw new Error("Unsupported placement "+p);n={top:o.top-h.outerHeight(),left:o.left+o.width/2},l={top:n.top+t,left:n.left-h.width()/2},l.left=Math.max(q,l.left),s-=l.top,m={left:n.left-l.left}}h.removeClass("left right bottom top"),h.addClass(p),h.css({top:void 0!==l.top?l.top+"px":"initial",left:void 0!==l.left?l.left+"px":"initial",right:void 0!==l.right?l.right+"px":"initial",display:"block",maxHeight:s});var u=h.find(".popover-title"),v=h.find(".popover-content"),w=h.find(".popover-footer");v.css({maxHeight:s-w.outerHeight()-u.outerHeight()-4,overflow:"auto"}),m&&i.css(m),h.removeClass("hide"),b.on("mousedown",g),b.on("click",f),e(j.popupShown)(c)}function m(a,e,f){var g=d(p)(e);n={el:g,options:f,scope:e};var h=b.find("body");h.append(g);var i=$("<div />",{"class":"arrow"});g.children(".arrow").remove(),g.append(i),e.$reposition=function(){var b=f.popupClass;b&&g.addClass(b),c(function(){l(e,a,g,i,f)})}}var n=null,o=null,p='<div class="popover"><div ng-include="popupView" onload="$reposition()"></div></div>',q=10;return{show:j,close:h}}]).directive("popupShow",["Popup","$parse","$timeout",function(a,b,c){return{restrict:"A",scope:!0,link:function(d,e,f){e.click(function(){c(function(){a.close();var c=b(f.popupIf||"true");c(d)&&a.show(e,d,f)})})}}}]).directive("popupAutoShow",["Popup","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){c.$watch(e.popupAutoShow,function(f){if(f){a.close();var g=b(e.popupIf||"true");g(c)&&a.show(d,c,e)}})}}}]);